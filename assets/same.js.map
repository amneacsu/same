{"version":3,"sources":["webpack:///same.js","webpack:///webpack/bootstrap 1bb311f3ae9238da7ab8","webpack:///./src/same.js","webpack:///./src/canvas.js","webpack:///./src/x.js","webpack:///./src/game.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_canvas","_x","_game","tick","render","gameToCanvas","game","window","requestAnimationFrame","event","action","e","cellOffset","click","canvas","addEventListener","move","handle","Object","defineProperty","value","document","getElementById","context","getContext","fillColors","twoPI","Math","PI","cellSize","erase","clearRect","width","height","makeSprite","color","circle","sprite","getImageData","x","y","radius","fillStyle","beginPath","arc","closePath","fill","sprites","map","drawScore","score","fillText","drawCell","cell","putImageData","offsetX","offsetY","state","cells","forEach","font","grid","current","bonus","points","matched","length","rand","b","random","self","item","hasProps","props","keys","every","prop","find","list","filter","compact","moveRight","moveDown","spaceBelow","match","unmatch","remove","splice","indexOf","column","row","randomCell","fall","collapseColumns","x2","applyGravity","neighbours","matchCells","coords","n","arguments","undefined","push"],"mappings":"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","file":"same.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvas = __webpack_require__(1);\n\t\n\tvar _x = __webpack_require__(2);\n\t\n\tvar _game = __webpack_require__(3);\n\t\n\tvar tick = function tick() {\n\t  (0, _canvas.render)((0, _x.gameToCanvas)(_game.game));\n\t  window.requestAnimationFrame(tick);\n\t};\n\t\n\tvar event = function event(action) {\n\t  return function (e) {\n\t    action((0, _canvas.cellOffset)(e), _game.click);\n\t  };\n\t};\n\t\n\t_canvas.canvas.addEventListener('click', event(_game.click));\n\t_canvas.canvas.addEventListener('click', event(_game.move));\n\t_canvas.canvas.addEventListener('mousemove', (0, _game.handle)(_game.handle));\n\twindow.addEventListener('load', tick);\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar canvas = exports.canvas = document.getElementById('same');\n\tvar context = exports.context = canvas.getContext('2d');\n\t\n\tvar fillColors = ['#DDD', '#8C3', '#FD0', '#F0E', '#4AF', '#F04'];\n\tvar twoPI = 2 * Math.PI;\n\tvar cellSize = 48;\n\t\n\tvar erase = function erase() {\n\t  return context.clearRect(0, 0, canvas.width, canvas.height);\n\t};\n\t\n\tvar makeSprite = function makeSprite(color) {\n\t  circle(24, 24, 20, color);\n\t  var sprite = context.getImageData(0, 0, cellSize, cellSize);\n\t  erase();\n\t  return sprite;\n\t};\n\t\n\tvar circle = function circle(x, y, radius, color) {\n\t  context.fillStyle = color;\n\t  context.beginPath();\n\t  context.arc(x, y, radius, 0, twoPI, false);\n\t  context.closePath();\n\t  context.fill();\n\t};\n\t\n\tvar sprites = fillColors.map(makeSprite);\n\t\n\tvar drawScore = function drawScore(score) {\n\t  context.fillStyle = '#432';\n\t  context.fillText(score, 5, 610);\n\t};\n\t\n\tvar drawCell = function drawCell(cell) {\n\t  context.putImageData(sprites[cell.m ? 0 : cell.c], cell.x * cellSize, cell.y * cellSize);\n\t};\n\t\n\tvar cellOffset = exports.cellOffset = function cellOffset(e) {\n\t  return {\n\t    x: ~ ~(e.offsetX / cellSize) + 1,\n\t    y: ~ ~(e.offsetY / cellSize) + 1\n\t  };\n\t};\n\t\n\tvar render = exports.render = function render(state) {\n\t  erase();\n\t  state.cells.forEach(drawCell);\n\t  drawScore(state.score);\n\t};\n\t\n\tcontext.font = '24px sans-serif';\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar drawCell = function drawCell(cell) {\n\t  return cell;\n\t};\n\t\n\tvar gameToCanvas = exports.gameToCanvas = function gameToCanvas(game) {\n\t  var grid = game.grid;\n\t  var score = game.score;\n\t\n\t\n\t  return {\n\t    cells: grid.map(drawCell),\n\t    score: 'Score: ' + score.current + (score.bonus > 0 ? ' + ' + score.bonus : '')\n\t  };\n\t};\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar grid = [];\n\tvar score = { current: 0, bonus: 0 };\n\t\n\tvar game = exports.game = { grid: grid, score: score };\n\t\n\tvar width = 11;\n\tvar height = 12;\n\t\n\tvar points = function points(matched) {\n\t  return matched.length * (matched.length - 1);\n\t};\n\tvar rand = function rand(b) {\n\t  return ~ ~(Math.random() * b);\n\t};\n\tvar self = function self(item) {\n\t  return item;\n\t};\n\t\n\tvar hasProps = function hasProps(props) {\n\t  return function (cell) {\n\t    return Object.keys(props).every(function (prop) {\n\t      return cell[prop] === props[prop];\n\t    });\n\t  };\n\t};\n\tvar find = function find(list, props) {\n\t  return list.find(hasProps(props));\n\t};\n\tvar filter = function filter(props) {\n\t  return grid.filter(hasProps(props));\n\t};\n\tvar compact = function compact(list) {\n\t  return list.filter(self);\n\t};\n\t\n\tvar moveRight = function moveRight(cell) {\n\t  return cell.x += 1;\n\t};\n\tvar moveDown = function moveDown(cell) {\n\t  return cell.y += 1;\n\t};\n\tvar spaceBelow = function spaceBelow(cell) {\n\t  return !find(grid, { x: cell.x, y: cell.y + 1 });\n\t};\n\tvar match = function match(cell) {\n\t  return cell.m = true;\n\t};\n\tvar unmatch = function unmatch(cell) {\n\t  return cell.m = false;\n\t};\n\tvar remove = function remove(cell) {\n\t  return grid.splice(grid.indexOf(cell), 1);\n\t};\n\t\n\tvar column = function column(x) {\n\t  return filter({ x: x });\n\t};\n\tvar row = function row(y) {\n\t  return filter({ y: y });\n\t};\n\t\n\tvar randomCell = function randomCell(x, y) {\n\t  var c = rand(5) + 1,\n\t      matched = false;\n\t  return { x: x, y: y, c: c, matched: matched };\n\t};\n\t\n\tvar fall = function fall(cell) {\n\t  while (cell.y < height - 1 && spaceBelow(cell)) {\n\t    moveDown(cell);\n\t  }\n\t};\n\t\n\tvar collapseColumns = function collapseColumns() {\n\t  for (var x = width - 1; x >= 2; x--) {\n\t    if (column(x).length) continue;\n\t\n\t    for (var x2 = x - 1; x2 >= 1; x2--) {\n\t      column(x2).forEach(moveRight);\n\t    }\n\t  }\n\t};\n\t\n\tvar applyGravity = function applyGravity() {\n\t  for (var y = height - 1; y >= 1; y--) {\n\t    row(y).forEach(fall);\n\t  }\n\t};\n\t\n\tvar click = exports.click = function click(cell) {\n\t  var matched = matchCells(cell);\n\t\n\t  if (matched.length >= 2) {\n\t    score.current += points(matched);\n\t    matched.forEach(remove);\n\t    applyGravity();\n\t    collapseColumns();\n\t  }\n\t};\n\t\n\tvar move = exports.move = function move(cell) {\n\t  grid.forEach(unmatch);\n\t  var matched = matchCells(cell);\n\t\n\t  if (matched.length >= 2) {\n\t    matched.forEach(match);\n\t    score.bonus = points(matched);\n\t  }\n\t};\n\t\n\tvar handle = exports.handle = function handle(coords, action) {\n\t  var cell = find(coords);\n\t  cell && action(cell);\n\t};\n\t\n\tvar neighbours = function neighbours(cell) {\n\t  var cells = filter({ c: cell.c });\n\t\n\t  var n = [find(cells, { x: cell.x, y: cell.y + 1 }), find(cells, { x: cell.x, y: cell.y - 1 }), find(cells, { x: cell.x + 1, y: cell.y }), find(cells, { x: cell.x - 1, y: cell.y })];\n\t\n\t  return compact(n);\n\t};\n\t\n\tvar matchCells = function matchCells(cell) {\n\t  var list = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\t\n\t  list.push(cell);\n\t\n\t  neighbours(cell).forEach(function (c) {\n\t    if (list.indexOf(c) === -1) matchCells(c, list);\n\t  });\n\t\n\t  return list;\n\t};\n\t\n\tfor (var y = 0; y < height; y++) {\n\t  for (var x = 0; x < width; x++) {\n\t    grid.push(randomCell(x, y));\n\t  }\n\t}\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** same.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 1bb311f3ae9238da7ab8\n **/","import { canvas, render, cellOffset } from './canvas';\nimport { gameToCanvas } from './x';\nimport { handle, click, move, game } from './game';\n\nconst tick = function() {\n  render(gameToCanvas(game));\n  window.requestAnimationFrame(tick);\n}\n\nconst event = action => {\n  return e => {\n    action(cellOffset(e), click);\n  }\n}\n\ncanvas.addEventListener('click', event(click));\ncanvas.addEventListener('click', event(move));\ncanvas.addEventListener('mousemove', handle(handle));\nwindow.addEventListener('load', tick);\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/same.js\n **/","export const canvas = document.getElementById('same');\nexport const context = canvas.getContext('2d');\n\nconst fillColors = ['#DDD', '#8C3', '#FD0', '#F0E', '#4AF', '#F04'];\nconst twoPI = 2 * Math.PI;\nconst cellSize = 48;\n\nconst erase = () => context.clearRect(0, 0, canvas.width, canvas.height);\n\nconst makeSprite = color => {\n  circle(24, 24, 20, color);\n  let sprite = context.getImageData(0, 0, cellSize, cellSize);\n  erase();\n  return sprite;\n}\n\nconst circle = (x, y, radius, color) => {\n  context.fillStyle = color;\n  context.beginPath();\n  context.arc(x, y, radius, 0, twoPI, false);\n  context.closePath();\n  context.fill();\n}\n\nconst sprites = fillColors.map(makeSprite);\n\nconst drawScore = score => {\n  context.fillStyle = '#432';\n  context.fillText(score, 5, 610);\n}\n\nconst drawCell = cell => {\n  context.putImageData(sprites[cell.m ? 0 : cell.c], cell.x * cellSize, cell.y * cellSize);\n};\n\nexport const cellOffset = e => {\n  return {\n    x: ~~(e.offsetX / cellSize) + 1,\n    y: ~~(e.offsetY / cellSize) + 1\n  };\n}\n\nexport const render = state => {\n  erase();\n  state.cells.forEach(drawCell);\n  drawScore(state.score);\n};\n\ncontext.font = '24px sans-serif';\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/canvas.js\n **/","const drawCell = cell => {\n  return cell;\n};\n\nexport const gameToCanvas = (game) => {\n  let { grid, score } = game;\n\n  return {\n    cells: grid.map(drawCell),\n    score: `Score: ${score.current}` + (score.bonus > 0 ? ` + ${score.bonus}` : '')\n  };\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/x.js\n **/","const grid = [];\nconst score = { current: 0, bonus: 0 };\n\nexport const game = { grid, score };\n\nconst width = 11;\nconst height = 12;\n\nconst points = (matched) => matched.length * (matched.length - 1);\nconst rand = b => ~~(Math.random() * b);\nconst self = item => item;\n\nconst hasProps = props => cell => Object.keys(props).every((prop) => cell[prop] === props[prop]);\nconst find = (list, props) => list.find(hasProps(props));\nconst filter = props => grid.filter(hasProps(props));\nconst compact = list => list.filter(self);\n\nconst moveRight = cell => cell.x += 1;\nconst moveDown = cell => cell.y += 1;\nconst spaceBelow = cell => !find(grid, {x: cell.x, y: cell.y + 1});\nconst match = cell => cell.m = true;\nconst unmatch = cell => cell.m = false;\nconst remove = cell => grid.splice(grid.indexOf(cell), 1);\n\nconst column = x => filter({x});\nconst row = y => filter({y});\n\nconst randomCell = (x, y) => {\n  let c = rand(5) + 1, matched = false;\n  return {x, y, c, matched};\n};\n\nconst fall = cell => {\n  while (cell.y < height - 1 && spaceBelow(cell)) moveDown(cell);\n};\n\nconst collapseColumns = () => {\n  for (let x = width - 1; x >= 2; x--) {\n    if (column(x).length) continue;\n\n    for (let x2 = x - 1; x2 >= 1; x2--) {\n      column(x2).forEach(moveRight);\n    }\n  }\n};\n\nconst applyGravity = () => {\n  for (let y = height - 1; y >= 1; y--) {\n    row(y).forEach(fall);\n  }\n}\n\nexport const click = cell => {\n  let matched = matchCells(cell);\n\n  if (matched.length >= 2) {\n    score.current += points(matched);\n    matched.forEach(remove);\n    applyGravity();\n    collapseColumns();\n  }\n}\n\nexport const move = cell => {\n  grid.forEach(unmatch);\n  let matched = matchCells(cell);\n\n  if (matched.length >= 2) {\n    matched.forEach(match);\n    score.bonus = points(matched);\n  }\n}\n\nexport const handle = (coords, action) => {\n  const cell = find(coords);\n  cell && action(cell);\n}\n\nconst neighbours = cell => {\n  let cells = filter({c: cell.c});\n\n  let n = [\n    find(cells, {x: cell.x, y: cell.y + 1}),\n    find(cells, {x: cell.x, y: cell.y - 1}),\n    find(cells, {x: cell.x + 1, y: cell.y}),\n    find(cells, {x: cell.x - 1, y: cell.y})\n  ];\n\n  return compact(n);\n}\n\nconst matchCells = (cell, list = []) => {\n  list.push(cell);\n\n  neighbours(cell).forEach(function(c) {\n    if (list.indexOf(c) === -1) matchCells(c, list);\n  });\n\n  return list;\n};\n\nfor (let y = 0; y < height; y++) {\n  for (let x = 0; x < width; x++) {\n    grid.push(randomCell(x, y));\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/game.js\n **/"],"sourceRoot":""}